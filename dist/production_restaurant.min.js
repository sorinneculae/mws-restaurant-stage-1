"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),DBHelper=function(){function DBHelper(){_classCallCheck(this,DBHelper)}return _createClass(DBHelper,null,[{key:"fetchRestaurants",value:function(callback){fetch(DBHelper.DATABASE_URL).then(function(response){return response.ok?response.json():callback("Request failed. Returned status of "+response.status,null)}).then(function(response){return callback(null,response)}).catch(function(error){return callback("Request failed",null)})}},{key:"fetchRestaurantById",value:function(id,callback){fetch(DBHelper.DATABASE_URL+"/"+id).then(function(response){return response.json()}).then(function(response){return callback(null,response)}).catch(function(error){return callback("Restaurant does not exist",null)})}},{key:"fetchRestaurantByCuisine",value:function(cuisine,callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var results=restaurants.filter(function(r){return r.cuisine_type==cuisine});callback(null,results)}})}},{key:"fetchRestaurantByNeighborhood",value:function(neighborhood,callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var results=restaurants.filter(function(r){return r.neighborhood==neighborhood});callback(null,results)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(cuisine,neighborhood,callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var results=restaurants;"all"!=cuisine&&(results=results.filter(function(r){return r.cuisine_type==cuisine})),"all"!=neighborhood&&(results=results.filter(function(r){return r.neighborhood==neighborhood})),callback(null,results)}})}},{key:"fetchNeighborhoods",value:function(callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var neighborhoods=restaurants.map(function(v,i){return restaurants[i].neighborhood}),uniqueNeighborhoods=neighborhoods.filter(function(v,i){return neighborhoods.indexOf(v)==i});callback(null,uniqueNeighborhoods)}})}},{key:"fetchCuisines",value:function(callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var cuisines=restaurants.map(function(v,i){return restaurants[i].cuisine_type}),uniqueCuisines=cuisines.filter(function(v,i){return cuisines.indexOf(v)==i});callback(null,uniqueCuisines)}})}},{key:"urlForRestaurant",value:function(restaurant){return"./restaurant.html?id="+restaurant.id}},{key:"imageUrlForRestaurant",value:function(restaurant,type){return"/img/"+restaurant.id+(""!=type?"-":"")+type+".jpg"}},{key:"mapMarkerForRestaurant",value:function(restaurant,map){return new google.maps.Marker({position:restaurant.latlng,title:restaurant.name,url:DBHelper.urlForRestaurant(restaurant),map:map,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),DBHelper}(),restaurant=void 0,map;window.initMap=function(){fetchRestaurantFromURL(function(error,restaurant){error?console.error(error):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:restaurant.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},window.addEventListener("load",function(){return initSW()}),initSW=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("SW is working!")}).catch(function(){console.log("SW reg failed!")})},fetchRestaurantFromURL=function(callback){if(self.restaurant)return void callback(null,self.restaurant);var id=getParameterByName("id");id?DBHelper.fetchRestaurantById(id,function(error,restaurant){if(self.restaurant=restaurant,!restaurant)return void console.error(error);fillRestaurantHTML(),callback(null,restaurant)}):(error="No restaurant id in URL",callback(error,null))},fillRestaurantHTML=function(){var restaurant=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=restaurant.name,document.getElementById("restaurant-address").innerHTML=restaurant.address;var image=document.getElementById("restaurant-img");image.className="restaurant-img",image.src=DBHelper.imageUrlForRestaurant(restaurant,"default"),image.srcset=DBHelper.imageUrlForRestaurant(restaurant,"small")+" 325w, "+DBHelper.imageUrlForRestaurant(restaurant,"medium")+" 500w, "+DBHelper.imageUrlForRestaurant(restaurant,"")+" 800w",image.sizes="(min-width: 768px) calc( 100vw / 2 - 100px ), (min-width: 1200px) calc( 100vw / 3 - 100px ), (min-width: 1920px) calc( 100vw / 4 - 100px )",image.alt=restaurant.name+" Restaurant in "+restaurant.neighborhood,document.getElementById("restaurant-cuisine").innerHTML=restaurant.cuisine_type,restaurant.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var operatingHours=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,hours=document.getElementById("restaurant-hours");for(var key in operatingHours){var row=document.createElement("tr");row.tabIndex=0;var day=document.createElement("td");day.innerHTML=key,row.appendChild(day);var time=document.createElement("td");time.innerHTML=operatingHours[key],row.appendChild(time),hours.appendChild(row)}},fillReviewsHTML=function(){var reviews=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,container=document.getElementById("reviews-container"),title=document.createElement("h4");if(title.innerHTML="Reviews",title.tabIndex=0,container.appendChild(title),!reviews){var noReviews=document.createElement("p");return noReviews.innerHTML="No reviews yet!",noReviews.tabIndex=0,void container.appendChild(noReviews)}var ul=document.getElementById("reviews-list");reviews.forEach(function(review){ul.appendChild(createReviewHTML(review))}),container.appendChild(ul)},createReviewHTML=function(review){var li=document.createElement("li"),name_date=document.createElement("div");name_date.className="review-name-date",name_date.tabIndex="0",li.appendChild(name_date);var name=document.createElement("p");name.innerHTML=review.name,name.className="reviewer",name.tabIndex="0",name_date.appendChild(name);var date=document.createElement("p");date.innerHTML=review.date,date.className="review-date",date.tabIndex="0",name_date.appendChild(date);var rating=document.createElement("p");rating.innerHTML="Rating: "+review.rating,rating.tabIndex="0",rating.className="rating",li.appendChild(rating);var comments=document.createElement("p");return comments.innerHTML=review.comments,comments.tabIndex="0",li.appendChild(comments),li},fillBreadcrumb=function(){var restaurant=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,breadcrumb=document.getElementById("breadcrumb"),li=document.createElement("li");li.innerHTML=restaurant.name,breadcrumb.appendChild(li)},getParameterByName=function(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},window.addEventListener("load",function(){return initSW()});var initSW=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("SW is working! ----- ")}).catch(function(){console.log("SW reg failed!")})};