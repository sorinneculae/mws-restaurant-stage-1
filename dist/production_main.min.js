"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),DBHelper=function(){function DBHelper(){_classCallCheck(this,DBHelper)}return _createClass(DBHelper,null,[{key:"fetchRestaurants",value:function(callback){fetch(DBHelper.DATABASE_URL).then(function(response){return response.ok?response.json():callback("Request failed. Returned status of "+response.status,null)}).then(function(response){return callback(null,response)}).catch(function(error){return callback("Request failed",null)})}},{key:"fetchRestaurantById",value:function(id,callback){fetch(DBHelper.DATABASE_URL+"/"+id).then(function(response){return response.json()}).then(function(response){return callback(null,response)}).catch(function(error){return callback("Restaurant does not exist",null)})}},{key:"fetchRestaurantByCuisine",value:function(cuisine,callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var results=restaurants.filter(function(r){return r.cuisine_type==cuisine});callback(null,results)}})}},{key:"fetchRestaurantByNeighborhood",value:function(neighborhood,callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var results=restaurants.filter(function(r){return r.neighborhood==neighborhood});callback(null,results)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(cuisine,neighborhood,callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var results=restaurants;"all"!=cuisine&&(results=results.filter(function(r){return r.cuisine_type==cuisine})),"all"!=neighborhood&&(results=results.filter(function(r){return r.neighborhood==neighborhood})),callback(null,results)}})}},{key:"fetchNeighborhoods",value:function(callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var _neighborhoods=restaurants.map(function(v,i){return restaurants[i].neighborhood}),uniqueNeighborhoods=_neighborhoods.filter(function(v,i){return _neighborhoods.indexOf(v)==i});callback(null,uniqueNeighborhoods)}})}},{key:"fetchCuisines",value:function(callback){DBHelper.fetchRestaurants(function(error,restaurants){if(error)callback(error,null);else{var _cuisines=restaurants.map(function(v,i){return restaurants[i].cuisine_type}),uniqueCuisines=_cuisines.filter(function(v,i){return _cuisines.indexOf(v)==i});callback(null,uniqueCuisines)}})}},{key:"urlForRestaurant",value:function(restaurant){return"./restaurant.html?id="+restaurant.id}},{key:"imageUrlForRestaurant",value:function(restaurant,type){return"/img/"+restaurant.id+(""!=type?"-":"")+type+".jpg"}},{key:"mapMarkerForRestaurant",value:function(restaurant,map){return new google.maps.Marker({position:restaurant.latlng,title:restaurant.name,url:DBHelper.urlForRestaurant(restaurant),map:map,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),DBHelper}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,map,markers=[];document.addEventListener("DOMContentLoaded",function(event){fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(error,neighborhoods){error?console.error(error):(self.neighborhoods=neighborhoods,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var neighborhoods=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,select=document.getElementById("neighborhoods-select");neighborhoods.forEach(function(neighborhood){var option=document.createElement("option");option.innerHTML=neighborhood,option.value=neighborhood,select.append(option)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(error,cuisines){error?console.error(error):(self.cuisines=cuisines,fillCuisinesHTML())})},fillCuisinesHTML=function(){var cuisines=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.cuisines,select=document.getElementById("cuisines-select");cuisines.forEach(function(cuisine){var option=document.createElement("option");option.innerHTML=cuisine,option.value=cuisine,select.append(option)})};window.initMap=function(){var loc={lat:40.722216,lng:-73.987501};self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:loc,scrollwheel:!1,title:"Google Maps"}),updateRestaurants()};var updateRestaurants=function(){var cSelect=document.getElementById("cuisines-select"),nSelect=document.getElementById("neighborhoods-select"),cIndex=cSelect.selectedIndex,nIndex=nSelect.selectedIndex,cuisine=cSelect[cIndex].value,neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,function(error,restaurants){error?console.error(error):(resetRestaurants(restaurants),fillRestaurantsHTML())})},resetRestaurants=function(restaurants){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(m){return m.setMap(null)}),self.markers=[],self.restaurants=restaurants},fillRestaurantsHTML=function(){var restaurants=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,ul=document.getElementById("restaurants-list");restaurants.forEach(function(restaurant){ul.append(createRestaurantHTML(restaurant))}),addMarkersToMap()},createRestaurantHTML=function(restaurant){var li=document.createElement("li"),image=document.createElement("img");image.className="restaurant-img",image.src=DBHelper.imageUrlForRestaurant(restaurant,"default"),image.srcset=DBHelper.imageUrlForRestaurant(restaurant,"small")+" 325w, "+DBHelper.imageUrlForRestaurant(restaurant,"medium")+" 500w, "+DBHelper.imageUrlForRestaurant(restaurant,"")+" 800w",image.sizes="(min-width: 768px) calc( 100vw / 2 - 100px ), (min-width: 1200px) calc( 100vw / 3 - 100px ), (min-width: 1920px) calc( 100vw / 4 - 100px )",image.alt=restaurant.name+" Restaurant in "+restaurant.neighborhood,image.tabIndex=0,li.append(image);var name=document.createElement("h2");name.innerHTML=restaurant.name,name.tabIndex=0,li.append(name);var neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood,neighborhood.tabIndex=0,li.append(neighborhood);var address=document.createElement("p");address.innerHTML=restaurant.address,address.tabIndex=0,li.append(address);var more=document.createElement("a");return more.innerHTML="View Details",more.href=DBHelper.urlForRestaurant(restaurant),li.append(more),li},addMarkersToMap=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(restaurant){var marker=DBHelper.mapMarkerForRestaurant(restaurant,self.map);google.maps.event.addListener(marker,"click",function(){window.location.href=marker.url}),self.markers.push(marker)})};window.addEventListener("load",function(){return initSW()});var initSW=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("SW is working! ----- ")}).catch(function(){console.log("SW reg failed!")})};